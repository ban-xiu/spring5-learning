# 三级缓存
三级缓存可以用于解决循环依赖的问题

一级缓存存放初始化的完整对象，二级缓存存放已经实例化但未初始化的对象，三级缓存存放当前 bean 的 beanFactory

主要流程：doCreateBean() 方法中，bean 实例化完成后，di 注入之前会会先走记录三级缓存的方法

规则是：当一级缓存中没有对应 bean 时，记录三级缓存 -> 删除对应的二级缓存 -> 标记当前 bean 正在创建

在 applyPropertyValues() 方法做属性注入时，如果遇到了 RuntimeBeanReference 包装的 bean 对象引用类型会走：

尝试从一级缓存中加载 -> 如果一级缓存中没有且该 bean 被标记为正在创建 -> 尝试从二级缓存中加载 -> 如果二级中没有 -> 从三级缓存中加载并放入二级缓存后清除当前三级缓存 -> 如果都获取不到才开始创建新的 bean

具体例子：A 和 B 两个对象相互依赖

对于 A：
1. 实例化 A
2. 在三级缓存中记录半成品 A
3. 标记 A 正在创建
4. 填充属性时发现依赖 B
5. 尝试从缓存中获取 B，发现没
6. 开始创建 B

对于 B：
1. 实例化 B
2. 在三级缓存中记录半成品 B
3. 标记 B 正在创建
4. 填充属性时发现依赖 A
5. 尝试从缓存中获取 A
6. B 创建完成 -> A 创建完成